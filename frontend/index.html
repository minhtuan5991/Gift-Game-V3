<script>
const socket = io("https://gift-game-v3.onrender.com");

let me=null;
let currentTurn=null;

/* ================= HOST ================= */

function hostLogin(){
 socket.emit("hostJoin",document.getElementById("hostCode").value);
}

socket.on("hostOK",()=>alert("HOST MODE"));
socket.on("hostFail",()=>alert("Sai mÃ£ host"));

/* ================= PLAYER ================= */

function join(){
 socket.emit("playerJoin",document.getElementById("maSV").value);
}

socket.on("joinOK",st=>{
 me=st;
 alert("Joined "+st.Ten);
});

socket.on("joinFail",()=>alert("Sai mÃ£"));

/* ================= TURN ================= */

socket.on("turn",st=>{
 currentTurn=st;
 document.getElementById("turn").innerText="LÆ°á»£t: "+st.Ten;
});

/* ================= OPEN BOX ================= */

socket.on("box-opened",data=>{

 const { boxId, question } = data;

 if(currentOpenedBox && currentOpenedBox!==boxes[boxId])
   currentOpenedBox.style.backgroundImage=`url(${closeImg})`;

 const box=boxes[boxId];
 box.style.backgroundImage=`url(${openImg})`;
 currentOpenedBox=box;

 openSound.play();
 showPopup(question);

});

/* ================= STAR ================= */

starBtn.onclick=()=>{
 if(!me||!currentTurn) return;
 if(me.MaSV!==currentTurn.MaSV) return;

 starBtn.disabled=true;
 starBtn.classList.add("spin");

 socket.emit("spin-star");
};

socket.on("star-result",data=>{

 const { lucky } = data;

 starBtn.classList.remove("spin");
 stopStarSounds();

 if(lucky){
   starResult.innerText="ğŸ˜„ 10 ÄIá»‚M-CÃ¡c cá»¥ gÃ¡nh cÃ²ng lÆ°ng";
   luckySound.play();
   fireworks();confettiRain();
 } else {
   starResult.innerText="ğŸ˜­ 5Ä‘-ThÃ¬ pháº£i, pháº£i gÃ¬ áº¡";
   starBtn.classList.add("gray");
   unluckySound.play();
 }

});
</script>
